<div class="card" id="todos-section" hx-get="/partials/todos" hx-trigger="sse:todos, sse:worktrees" hx-swap="outerHTML">
    <div class="card-header">
        <h2 class="card-title"><span class="icon">ğŸ“‹</span> TODOs</h2>
    </div>

    <!-- Add Todo Form -->
    <form hx-post="/api/todo" hx-swap="none" hx-on::after-request="this.reset()" class="input-group"
        style="margin-bottom: 1rem;">
        <input type="text" name="content" placeholder="Add a new todo..." required autocomplete="off">
        <label class="checkbox-container" title="Create a git worktree for this todo">
            <input type="checkbox" name="create_worktree" value="true">
            <span class="icon">ğŸŒ¿</span>
        </label>
        <button type="submit">
            <span>âœ…</span> Add
        </button>
    </form>

    <!-- Todo List -->
    {% if todos and todos|length > 0 %}
    <ul class="todo-list">
        {% for todo in todos %}
        <li class="todo-item {{ todo.status }}" data-todo-id="{{ todo.todo_id }}">
            <div class="todo-main" onclick="toggleTodoMenu(event, '{{ todo.todo_id }}')">
                <span class="todo-index">{{ todo.todo_id }}</span>
                <span class="todo-content">{{ todo.content }}</span>
                {% if todo.worktree_requested %}
                <span class="worktree-icon" title="Worktree requested">ğŸŒ¿</span>
                {% endif %}
                <span class="todo-status {{ todo.status }}">{{ todo.status }}</span>
                <span class="todo-menu-indicator">â‹®</span>
            </div>
            {% if todo.worktree_paths and todo.worktree_paths|length > 0 %}
            <div class="todo-worktrees">
                {% for path in todo.worktree_paths %}
                <div class="worktree-path" title="{{ path }}">ğŸ“‚ {{ path }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>

    <!-- Menus (outside of list items to avoid opacity inheritance) -->
    {% for todo in todos %}
    <div class="todo-menu" id="todo-menu-{{ todo.todo_id }}" style="display: none;">
        {% if todo.status != 'done' %}
        <button class="menu-item btn-success" hx-patch="/api/todo/{{ todo.todo_id }}/done" hx-target="#todos-section"
            hx-swap="none" onclick="event.stopPropagation()">
            <span class="menu-icon">âœ“</span>
            <span class="menu-label">Mark as Done</span>
        </button>
        {% endif %}
        {% if todo.status != 'pending' %}
        <button class="menu-item btn-warning" hx-patch="/api/todo/{{ todo.todo_id }}/pending" hx-target="#todos-section"
            hx-swap="none" onclick="event.stopPropagation()">
            <span class="menu-icon">â†»</span>
            <span class="menu-label">Mark as Pending</span>
        </button>
        {% endif %}
        {% if todo.status != 'cancelled' %}
        <button class="menu-item btn-secondary" hx-patch="/api/todo/{{ todo.todo_id }}/cancelled" hx-swap="none"
            onclick="event.stopPropagation()">
            <span class="menu-icon">âœ•</span>
            <span class="menu-label">Cancel</span>
        </button>
        {% endif %}
        <button class="menu-item btn-danger" hx-delete="/api/todo/{{ todo.todo_id }}" hx-target="#todos-section"
            hx-swap="none" hx-confirm="Delete this todo?" onclick="event.stopPropagation()">
            <span class="menu-icon">ğŸ—‘ï¸</span>
            <span class="menu-label">Delete</span>
        </button>
    </div>
    {% endfor %}

    {% else %}
    <div class="empty-state">
        <div class="icon">âœ¨</div>
        <p>No todos yet. Add one above!</p>
    </div>
    {% endif %}
</div>